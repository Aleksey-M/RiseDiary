@page "{handler?}"
@model RiseDiary.WebUI.Pages.Images.EditModel
@{
    ViewData["Title"] = Model.Image.Name;
    ViewData["TitlePart"] = Model.Image.Name;
}

<div class="row">
    <div class="col-sm-10 col-sm-offset-1" style="padding-left:15px;padding-right:15px;">
        <table class="table">
            <thead>
                <tr>
                    <th style="width:25%">Название изображения</th>
                    <th>Ширина</th>
                    <th>Высота</th>
                    <th>Размер</th>
                    <th>
                        <div style="float:right;margin-right:10px;">
                            @if (Model.RecordId == 0)
                            {
                                <a href="/images/index" class="btn btn-default btn-sm" style="float:right">Закрыть</a>
                            }
                            else
                            {
                                <a href="/records/view?recordId=@Model.RecordId" class="btn btn-default btn-sm" style="float:right">Венуться к записи</a>
                            }
                        </div>
                        <div style="float:right; margin-right:10px;">
                            <form asp-page-handler="DeleteImage" method="post">
                                <input type="hidden" name="imageId" value="@Model.ImageId" />
                                <input type="hidden" name="recordId" value="@Model.RecordId" />
                                <button type="submit" class="btn btn-sm btn-danger"
                                        onclick="if (confirm('Удалить изображение?')) { return true; } else { return false; }">
                                    Удалить
                                </button>
                            </form>
                        </div>
                    </th>
                </tr>
            </thead>
            <tbody>
                <tr style="background-color:#cdff82">
                    <td>
                        <a asp-page="View" asp-route-imageId="@Model.ImageId" asp-route-recordId="@Model.RecordId"><span style="font-size:larger">@Model.Image.Name</span></a>
                    </td>
                    <td>@Model.Image.Width&nbsp;px;</td>
                    <td>@Model.Image.Height&nbsp;px;</td>
                    <td>@Model.Image.SizeKbString</td>
                    <td></td>

                </tr>
                @if (Model.TempImage != null)
                {
                    <tr style="background-color:#ffb3b3">
                        <td><b style="color:brown">@Model.TempImage.Modification</b></td>
                        <td>@Model.TempImage.Width&nbsp;px;</td>
                        <td>@Model.TempImage.Height&nbsp;px;</td>
                        <td>@Model.TempImage.SizeKbString</td>
                        <td>
                            <div class="form-inline" style="float:right;">
                                <form method="post">
                                    <input type="hidden" name="recordId" value="@Model.RecordId" />
                                    <input type="hidden" name="imageId" value="@Model.ImageId" />
                                    <input type="submit" asp-page-handler="SaveUpdatedImage" class="btn btn-warning btn-sm" value="Сохранить изменения" />
                                    <input type="submit" asp-page-handler="SaveUpdatedAsNewImage" class="btn btn-success btn-sm" value="Сохранить как новое" />
                                    <input type="submit" asp-page-handler="CancelEdit" class="btn btn-success btn-sm" value="Отменить изменения" />
                                </form>
                            </div>
                        </td>
                    </tr>
                }
                else
                {
                    <tr style="background-color:#ffef89">
                        <td>Заменить изображение</td>
                        <td colspan="3">
                            <b>Выберите файл:</b>
                        </td>
                        <td>
                            <form asp-page-handler="ReplaceImage" method="post" enctype="multipart/form-data">
                                <div class="form-inline" style="float:right; margin-right:10px;">
                                    <div class="form-group-sm">
                                        <input type="hidden" name="recordId" value="@Model.RecordId" />
                                        <input type="hidden" name="imageId" value="@Model.ImageId" />
                                        <input type="file" accept="image/*" id="newImage" name="newImage" class="form-control" style="padding:0px;border:none;width:200px;" />
                                        <input type="submit" value="Заменить" class="btn btn-sm btn-info" style="width:80px;" />
                                    </div>
                                </div>
                            </form>
                        </td>
                    </tr>
                    <tr style="background-color:#ffef89">
                        <td>Сжать изображение</td>
                        <td colspan="3"><b>Введите размер большей стороны в пикселях:</b></td>
                        <td>
                            <form method="post" asp-page-handler="ScaleImage">
                                <div class="form-inline" style="float:right;margin-right:10px;">
                                    <div class="form-group-sm">
                                        <input type="hidden" name="recordId" value="@Model.RecordId" />
                                        <input type="hidden" name="imageId" value="@Model.ImageId" />
                                        <input type="number" style="width:200px;" class="form-control" name="imageSize" id="imageSize" max="@Model.BiggestImageDimm" value="@Model.BiggestImageDimm" />
                                        <input type="submit" class="btn btn-info btn-sm" style="width:80px;" value="Сжать" />
                                    </div>
                                </div>
                            </form>
                        </td>
                    </tr>

                    <tr style="background-color:#ffef89">
                        <td>Обрезать изображение</td>
                        <td colspan="3"><b>Выберите область и нажмите:</b></td>
                        <td>
                            <div class="form-inline" style="float:right;margin-right:10px;">
                                <a asp-page="CropImageSelect" asp-route-imageId="@Model.ImageId" asp-route-recordId="@Model.RecordId" class="btn btn-info btn-sm" style="width:80px;">Обрезать</a>
                            </div>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
    <div class="col-sm-12" style="text-align:center">
        <p class="center-block">@Model.ImageUrl</p>
    </div>
    <div class="col-sm-12">
        @if (Model.TempImage == null)
        {
            <img id="img" name="img" src="data:image;base64,@Model.FullImageString" class="thumbnail center-block" style="max-height:600px;max-width:1000px;" />
        }
        else
        {
            <img id="img" name="img" src="data:image;base64,@Model.FullModifiedImageString" class="thumbnail center-block" style="max-height:600px;max-width:1000px;" />
        }
    </div>
</div>
