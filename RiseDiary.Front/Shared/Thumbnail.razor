@using RiseDiary.Shared.Images

@inject NavigationManager NavManager

<div class="card">
    @if (!OnlyImage)
    {
        <div class="card-header text-wrap text-center">
            <NavLink href="@EditImageUri">@Image.Name</NavLink>
        </div>
    }

    <div class="card-body">
        <div class="text-center">
            <NavLink style="cursor:pointer" @onclick="_ => ImageClick(Image.Id)">
                <img src="data:image/jpg;base64,@Image.Base64Thumbnail" class="img-thumbnail" />
            </NavLink>
        </div>
    </div>

    @if (!OnlyImage)
    {
        <div class="card-footer text-center">
            @if (ChildContent != null)
            {
                @ChildContent
            }
            else
            {
                @ImageShortInfo
            }
        </div>
    }
</div>

@code {
    [Parameter, EditorRequired]
    public ImageListItemDto Image { get; set; } = null!;

    [Parameter, EditorRequired]
    public Action<Guid> ImageClick { get; set; } = _ => { };

    [Parameter]
    public bool OnlyImage { get; set; }

    [Parameter]
    public RenderFragment? ChildContent { get; set; }

    [Parameter]
    public Guid? RecordId { get; set; }

    private MarkupString ImageShortInfo => new MarkupString(
        $"{Image?.Width ?? 0} / {Image?.Height ?? 0} <b>{Image?.SizeKb ?? "?"}</b>");

    private string EditImageUri => 
        NavManager.GetUriWithQueryParameters($"images/edit", new Dictionary<string, object?>
        {
            ["ImageId"] = Image.Id,
            ["RedirectRecordId"] = RecordId
        });
}
